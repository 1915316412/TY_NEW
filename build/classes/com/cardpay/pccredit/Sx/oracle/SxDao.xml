<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.Sx.dao.SxDao">
	  <resultMap id="BaseResultMap" type="com.cardpay.pccredit.Sx.model.SxOutputData" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.Sx.model.SxOutputData" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="SxResultMap" type="com.cardpay.pccredit.Sx.model.SxOutputData" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
	 	
	<!--  -->
 	<select id="findSxListByFilter" resultMap="SxResultMap" 
			parameterType="com.cardpay.pccredit.Sx.model.SxInputData">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  SELECT A .USER_ID as userId,SUBSTR(d.jzrq, 1, 6) as month,dept.name as deptName,p.product_name  as productName,e.display_name as displayName,sum(D .df) as total,count(D .df) as countSx,sum(yehz.JKJE) as jkje
					  FROM BASIC_CUSTOMER_INFORMATION A,
						CUSTOMER_APPLICATION_INFO B,
						TY_REPAY_LSZ D ,SYS_DEPT_USER deptuser,SYS_DEPARTMENT dept,SYS_USER e  ,product_attribute p,ty_repay_yehz yehz
						WHERE A .USER_ID=deptuser.USER_ID and deptuser.DEPT_ID=dept.id and A .USER_ID=e.id and 
						 A.ID=B.CUSTOMER_ID and B.JJH=D.JJH and p.id=b.product_id and D.JJH=yehz.JJH
						
						<if test="fdate!=null and ldate!=null">
						    and D.QXRX=#{fdate}
						</if>
						<if test="product!=null and product !=''" >
						    and p.product_name like '%'||#{product}||'%'
						</if>
					 <!--   and zy='批量自动扣利息'   -->
						GROUP BY SUBSTR(d.jzrq, 1, 6),A .USER_ID,e.display_name,dept.name,p.product_name,yehz.JKJE  ORDER BY A .USER_ID,SUBSTR(d.jzrq, 1, 6),dept.name
					  
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
 	<!--  -->
		<select id="findSxListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.Sx.model.SxInputData">
			select count(*) from 
	  	(SELECT A .USER_ID as userId,SUBSTR(d.jzrq, 1, 6) as month,dept.name as deptName,p.product_name  as productName,e.display_name as displayName,sum(D .df) as total
					  FROM BASIC_CUSTOMER_INFORMATION A,
						CUSTOMER_APPLICATION_INFO B,
						TY_REPAY_LSZ D ,SYS_DEPT_USER deptuser,SYS_DEPARTMENT dept,SYS_USER e , product_attribute  p
						WHERE A .USER_ID=deptuser.USER_ID and deptuser.DEPT_ID=dept.id and A .USER_ID=e.id and 
						 A.ID=B.CUSTOMER_ID and B.JJH=D.JJH and p.id = b.product_id
						 	<if test="fdate!=null and ldate!=null">
						    and D.QXRX=#{fdate}
						</if>
						<if test="product!=null and product !=''" >
						    and p.product_name like '%'||#{product}||'%'
						</if>
						GROUP BY SUBSTR(d.jzrq, 1, 6),A .USER_ID,e.display_name,dept.name,p.product_name ORDER BY A .USER_ID,SUBSTR(d.jzrq, 1, 6),dept.name)
	</select> 
	 	
	 	<!--  -->
	 	<select id="findSxListByFilterNoPage" resultMap="SxResultMap" 
			parameterType="com.cardpay.pccredit.Sx.model.SxInputData">
					  SELECT A .USER_ID as userId,SUBSTR(d.jzrq, 1, 6) as month,dept.name as deptName,p.product_name as productName,e.display_name as displayName,sum(D .df) as total,count(D .df) as countSx 
					  FROM BASIC_CUSTOMER_INFORMATION A,
						CUSTOMER_APPLICATION_INFO B,
						TY_REPAY_LSZ D ,SYS_DEPT_USER deptuser,SYS_DEPARTMENT dept,SYS_USER e , product_attribute  p
						WHERE A .USER_ID=deptuser.USER_ID and deptuser.DEPT_ID=dept.id and A .USER_ID=e.id and 
						 A.ID=B.CUSTOMER_ID and B.JJH=D.JJH and p.id = b.product_id
							<if test="fdate!=null and ldate!=null">
						    and D.QXRX=#{fdate}
						</if>
						<if test="product!=null and product !=''" >
						    and p.product_name like '%'||#{product}||'%'
						</if>
					  
						GROUP BY SUBSTR(d.jzrq, 1, 6),A .USER_ID,e.display_name,dept.name,p.product_name ORDER BY A .USER_ID,SUBSTR(d.jzrq, 1, 6),dept.name
	
	</select>
	
	 	<select id="findje" parameterType="com.cardpay.pccredit.Sx.model.SxInputData" resultMap="SxResultMap">
	 		SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (   
	 	    SELECT A .USER_ID as userId,SUBSTR(d.jzrq, 1, 6) as month,dept.name as deptName,p.product_name as productName,e.display_name as displayName,sum(D .df) as total,count(D .df) as countSx ,yehz.JKJE as  jkje
					  FROM BASIC_CUSTOMER_INFORMATION A,
						CUSTOMER_APPLICATION_INFO B,
						TY_REPAY_LSZ D ,SYS_DEPT_USER deptuser,SYS_DEPARTMENT dept,SYS_USER e , product_attribute  p,ty_repay_yehz yehz  
						WHERE A .USER_ID=deptuser.USER_ID and deptuser.DEPT_ID=dept.id and A .USER_ID=e.id and 
						 A.ID=B.CUSTOMER_ID and B.JJH=D.JJH and p.id = b.product_id and D.JJH=yehz.JJH
						 <if test="fdate!=null and ldate!=null ">
						    and D.QXRX=#{fdate}
						</if>
						<if test="product!=null and product!=''">
						    and p.product_name like '%'||#{product}||'%'
						</if> 
						<if test="deptName!=null and deptName!=''">
						    and dept.name=#{deptName}
						</if>
						<if test="displayName!=null and displayName!=''">
						    and e.display_name=#{displayName}
						</if>
					  
						GROUP BY SUBSTR(d.jzrq, 1, 6),A .USER_ID,e.display_name,dept.name,p.product_name,yehz.JKJE ORDER BY A .USER_ID,SUBSTR(d.jzrq, 1, 6),dept.name
	   					 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	 	</select>
	 	
	 	<select id="findSxListCountByFilterje" resultType="int"
			parameterType="com.cardpay.pccredit.Sx.model.SxInputData">
			select count(*) from 
	  	(SELECT A .USER_ID as userId,SUBSTR(d.jzrq, 1, 6) as month,dept.name as deptName,p.product_name  as productName,e.display_name as displayName,sum(D .df) as total,yehz.JKJE as jkje
					  FROM BASIC_CUSTOMER_INFORMATION A,
						CUSTOMER_APPLICATION_INFO B,
						TY_REPAY_LSZ D ,SYS_DEPT_USER deptuser,SYS_DEPARTMENT dept,SYS_USER e , product_attribute  p,ty_repay_yehz yehz
						WHERE A .USER_ID=deptuser.USER_ID and deptuser.DEPT_ID=dept.id and A .USER_ID=e.id and 
						 A.ID=B.CUSTOMER_ID and B.JJH=D.JJH and p.id = b.product_id and D.JJH=yehz.JJH
						 <if test="fdate!=null and ldate!=null ">
						    and D.QXRX=#{fdate}
						</if>
						<if test="product!=null and product!=''">
						    and p.product_name like '%'||#{product}||'%'
						</if> 
						<if test="deptName!=null and deptName!=''">
						    and dept.name=#{deptName}
						</if>
						<if test="displayName!=null and displayName!=''">
						    and e.display_name=#{displayName}
						</if>
					  
						GROUP BY SUBSTR(d.jzrq, 1, 6),A .USER_ID,e.display_name,dept.name,p.product_name,yehz.JKJE ORDER BY A .USER_ID,SUBSTR(d.jzrq, 1, 6),dept.name)
	</select> 
	
	 	<select id="findteam"  resultMap="SxResultMap">
	 	    select NAME as deptName from SYS_DEPARTMENT
	 	</select>
	 	
	 	<select id="finduser"  resultMap="SxResultMap">
	 	    select DISPLAY_NAME as displayName from SYS_USER
	 	</select>
</mapper>
