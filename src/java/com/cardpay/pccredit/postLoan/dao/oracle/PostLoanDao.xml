<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cardpay.pccredit.postLoan.dao.PostLoanDao">


	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.postLoan.model.Fcloaninfo" >
   			  <result column="KEYCODE" 		property="keycode" jdbcType="VARCHAR" /> 
			  <result column="YEAR" 		property="year" jdbcType="VARCHAR" /> 
			  <result column="TIMES"		property="times" jdbcType="VARCHAR" /> 
			  <result column="BUSICODE" 	property="busicode" jdbcType="VARCHAR" /> 
			  <result column="BUSITYPE" 	property="busitype" jdbcType="VARCHAR" /> 
			  <result column="DEPTCODE" 	property="deptcode" jdbcType="VARCHAR" /> 
			  <result column="INSTCITYCODE" property="instcitycode" jdbcType="VARCHAR" /> 
			  <result column="CONTRACTCODE" property="contractcode" jdbcType="VARCHAR" /> 
			  <result column="CUSTID" 		property="custid" jdbcType="VARCHAR" /> 
			  <result column="CNAME" 		property="cname" jdbcType="VARCHAR" /> 
			  <result column="TYPEID" 		property="typeid" jdbcType="VARCHAR" /> 
			  <result column="CUSTTYPE" 	property="custtype" jdbcType="VARCHAR" /> 
			  <result column="CUSTPROPERTY" property="custproperty" jdbcType="VARCHAR" /> 
			  <result column="ORGCERTCODE" 	property="orgcertcode" jdbcType="VARCHAR" /> 
			  <result column="UNITCUSTTYPE" property="unitcusttype" jdbcType="VARCHAR" /> 
			  <result column="CARDTYPE" 	property="cardtype" jdbcType="VARCHAR" /> 
			  <result column="CARDNUM" 		property="cardnum" jdbcType="VARCHAR" /> 
			  <result column="CITY" 		property="city" jdbcType="VARCHAR" /> 
			  <result column="DISTRICTCOUNTY" property="districtcounty" jdbcType="VARCHAR" /> 
			  <result column="TOWN"			  property="town" jdbcType="VARCHAR" /> 
			  <result column="COMMUNITY" 	  property="community" jdbcType="VARCHAR" /> 
			  <result column="INSTCODE" 	  property="instcode" jdbcType="VARCHAR" /> 
			  <result column="CURRENCY" 	  property="currency" jdbcType="VARCHAR" /> 
			  <result column="MONEY" 		  property="money" jdbcType="VARCHAR" /> 
			  <result column="BALAMT" 		  property="balamt" jdbcType="VARCHAR" /> 
			  <result column="DEBTINTEREST"   property="debtinterest" jdbcType="VARCHAR" /> 
			  <result column="REQLMT" 		  property="reqlmt" jdbcType="VARCHAR" /> 
			  <result column="LOANDATE" 	  property="loandate" jdbcType="VARCHAR" /> 
			  <result column="ENDDATE" 		  property="enddate" jdbcType="VARCHAR" /> 
			  <result column="BUSISTATE"      property="busistate" jdbcType="VARCHAR" /> 
			  <result column="CREDITLEVEL"    property="creditlevel" jdbcType="VARCHAR" /> 
			  <result column="INDUSTRY"       property="industry" jdbcType="VARCHAR" /> 
			  <result column="LOANPURPOSE"    property="loanpurpose" jdbcType="VARCHAR" /> 
			  <result column="MAINASSURE"     property="mainassure" jdbcType="VARCHAR" /> 
			  <result column="BUSIMANAGER"    property="busimanager" jdbcType="VARCHAR" /> 
			  <result column="ISBACK" 		  property="isback" jdbcType="VARCHAR" /> 
			  <result column="ISBIGCOMPANY"   property="isbigcompany" jdbcType="VARCHAR" /> 
			  <result column="STATE" 		  property="state" jdbcType="VARCHAR" /> 
			  <result column="ISLOWRISK" 	  property="islowrisk" jdbcType="VARCHAR" /> 
			  <result column="VALIDTIME" 	  property="validtime" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULT"     property="sortresult" jdbcType="VARCHAR" /> 
			  <result column="SORTRESULTFIVE" property="sortresultfive" jdbcType="VARCHAR" /> 
			  <result column="PRESORTRESULT"  property="presortresult" jdbcType="VARCHAR" /> 
			  <result column="PRESORTFIVE"    property="presortfive" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTRESULT" property="autosortresult" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTREMARK" property="autosortremark" jdbcType="VARCHAR" /> 
			  <result column="AUTOSORTFIVE"   property="autosortfive" jdbcType="VARCHAR" /> 
			  <result column="ISADM" 		  property="isadm" jdbcType="VARCHAR" /> 
			  <result column="CUSTSCALE"      property="custscale" jdbcType="VARCHAR" /> 
			  <result column="OVERTIMES"      property="overtimes" jdbcType="VARCHAR" /> 
			  <result column="DELAYAMTDAYS"   property="delayamtdays" jdbcType="VARCHAR" /> 
			  <result column="DELAYINTERESTDAYS" property="delayinterestdays" jdbcType="VARCHAR" /> 
			  <result column="CHANGEFLAG" 		 property="changeflag" jdbcType="VARCHAR" /> 
			  <result column="CATEGORYTYPE" 	 property="categorytype" jdbcType="VARCHAR" /> 
			  <result column="OPERDATETIME"      property="operdatetime" jdbcType="VARCHAR" /> 
			  <result column="OPERATOR" 		 property="operator" jdbcType="VARCHAR" /> 
			  <result column="ISWORKMANU" 		 property="isworkmanu" jdbcType="VARCHAR" /> 
			  <result column="ADMDATE" 			 property="admdate" jdbcType="VARCHAR" /> 
			  <result column="AJUSTSTATE" 		 property="ajuststate" jdbcType="VARCHAR" /> 
			  <result column="ISTRANS" 			 property="istrans" jdbcType="VARCHAR" /> 
			  <result column="LASTYEARSORTRESULT" property="lastyearsortresult" jdbcType="VARCHAR" /> 
			  <result column="PROCESSID" 		  property="processid" jdbcType="VARCHAR" /> 
			  <result column="TOBADLOANREASON"    property="tobadloanreason" jdbcType="VARCHAR" /> 
			  <result column="BADLOANDATE" 		  property="badloandate" jdbcType="VARCHAR" /> 
			  <result column="CREATE_TIME" 		  property="create_time" jdbcType="VARCHAR" /> 
 	 </resultMap>
 	  <resultMap id="lszform" type="com.cardpay.pccredit.postLoan.model.TyRarepaylistForm" >
 	      	<result column="ywbh" 		property="ywbh" 			jdbcType="VARCHAR" />
 	      	<result column="khmc" 		property="khmc" 			jdbcType="VARCHAR" />
 	      	<result column="jkrq" 		property="jkrq" 			jdbcType="VARCHAR" />
 	      	<result column="bj" 		property="bj" 			jdbcType="VARCHAR" />
 	      	<result column="lx" 		property="lx" 			jdbcType="VARCHAR" />
 	      	<result column="jxfs" 		property="jxfs" 			jdbcType="VARCHAR" />
 	      	<result column="jzrq" 		property="jzrq" 			jdbcType="VARCHAR" />
 	      	<result column="create_time" 		property="create_time" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 <resultMap id="BaseResultMap2" type="com.cardpay.pccredit.postLoan.model.RarepaylistForm" >
   		<result column="KEYCODE" 		property="keycode" 			jdbcType="VARCHAR" />
		<result column="REPAYDATE" 		property="repaydate" 		jdbcType="VARCHAR" />
		<result column="BUSICODE" 		property="busicode" 		jdbcType="VARCHAR" />
		<result column="REPAYAMT" 		property="repayamt" 		jdbcType="VARCHAR" />
		<result column="RAPAYINTEREST"	property="rapayinterest" 	jdbcType="VARCHAR" />
		<result column="SQUAREMODEL" 	property="squaremodel" 		jdbcType="VARCHAR" />
		<result column="SQUAREOPER" 	property="squareoper" 		jdbcType="VARCHAR" />
		<result column="HANDLESCHEMAID" property="handleschemaid" 	jdbcType="VARCHAR" />
		<result column="HANDLETYPEID" 	property="handletypeid"     jdbcType="VARCHAR" />
		<result column="INSTCODE" 		property="instcode" 		jdbcType="VARCHAR" />
		<result column="DEPTCODE" 		property="deptcode" 		jdbcType="VARCHAR" />
		<result column="INSTCITYCODE" 	property="instcitycode" 	jdbcType="VARCHAR" />
		<result column="OPERDATETIME" 	property="operdatetime" 	jdbcType="VARCHAR" />
		<result column="OPERATOR_1" 	property="operator_1" 		jdbcType="VARCHAR" />
		<result column="LOANSTATUS"	    property="loanstatus" 		jdbcType="VARCHAR" />
		<result column="ISTRANS" 		property="istrans" 			jdbcType="VARCHAR" />
		<result column="CREATE_TIME" 	property="create_time" 		jdbcType="VARCHAR" />
		<result column="PARAM1" 	    property="param1" 			jdbcType="VARCHAR" />
 	 </resultMap>
 	 
 	 
 	 <resultMap id="BaseResultMap3" type="com.cardpay.pccredit.postLoan.model.MibusidataForm" >
   		 <result column="BUSICODE"        property="busicode"    jdbcType="VARCHAR" />         
		 <result column="CUSTID"        property="custid"    jdbcType="VARCHAR" />         
		 <result column="CNAME"        property="cname"    jdbcType="VARCHAR" />         
		 <result column="DEPTCODE"        property="deptcode"    jdbcType="VARCHAR" />         
		 <result column="MAINASSURE"        property="mainassure"    jdbcType="VARCHAR" />         
		 <result column="REQLMT"        property="reqlmt"    jdbcType="VARCHAR" />         
		 <result column="LOANDATE"        property="loandate"    jdbcType="VARCHAR" />         
		 <result column="STARTDATE"        property="startdate"    jdbcType="VARCHAR" />         
		 <result column="ORIENDDATE"        property="orienddate"    jdbcType="VARCHAR" />         
		 <result column="ENDDATE"        property="enddate"    jdbcType="VARCHAR" />         
		 <result column="MONEY"        property="money"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="STATE"        property="accountstate"    jdbcType="VARCHAR" />         
		 <result column="CLOSEDATE"        property="closedate"    jdbcType="VARCHAR" />         
		 <result column="FIVECLASS"        property="fiveclass"    jdbcType="VARCHAR" />         
		 <result column="DELAYAMTDAYS"        property="delayamtdays"    jdbcType="VARCHAR" />         
		 <result column="DELAYINTERESTDAYS"        property="delayinterestdays"    jdbcType="VARCHAR" />         
		 <result column="FIRSTINTERESTDATE"        property="firstinterestdate"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTEREST"        property="debtinterest"    jdbcType="VARCHAR" />         
		 <result column="DEBTINTERESTTIMES"        property="debtinteresttimes"    jdbcType="VARCHAR" />         
		 <result column="DLAYAMT"        property="dlayamt"    jdbcType="VARCHAR" />         
		 <result column="DLAYDT"        property="dlaydt"    jdbcType="VARCHAR" />         
		 <result column="PAYDEBT"        property="paydebt"    jdbcType="VARCHAR" />         
		 <result column="INDEBTAMT"        property="indebtamt"    jdbcType="VARCHAR" />         
		 <result column="OUTDEBTAMT"        property="outdebtamt"    jdbcType="VARCHAR" />         
		 <result column="BALAMT"        property="balamt"    jdbcType="VARCHAR" />         
		 <result column="CREATE_TIME"        property="create_time"    jdbcType="VARCHAR" />    
		 <result column="CUSTIDNO"        property="custidno"    jdbcType="VARCHAR" />  
		 <result column="LIMIT"        property="limit"    jdbcType="VARCHAR" />  
		 <result column="REPAYMETHOD"        property="repaymethod"    jdbcType="VARCHAR" />  
		 <result column="SPMC"        property="spmc"    jdbcType="VARCHAR" />  
		 <result column="JF"        property="jf"    jdbcType="VARCHAR" />  
		 <result column="AUDIT_TIME"        property="audittime"    jdbcType="DATE" />  
		 <result column="REFUSAL_REASON"        property="refusalreason"    jdbcType="VARCHAR" /> 
		 <result column="DISPLAY_NAME"        property="displayname"    jdbcType="VARCHAR" />  
 	 </resultMap>


	<resultMap id="CreditProcess" type="com.cardpay.pccredit.postLoan.model.CreditProcess" >
   		<result column="spmc" 		property="spmc"  />
		<result column="chinese_name" 	property="customername" />
		<result column="teamname" 	property="teamname" />
		<result column="bljg" 		property="bljg" />
		<result column="dklx" 		property="dklx" />
		<result column="assure_means"	property="mainassure"/>
		<result column="hyfl" 	property="industry" />
		<result column="display_name" 	property="mananger"/>
		<result column="created_time" property="applytime"/>
		<result column="apply_quota" 	property="applymoney"/>
		<result column="start_examine_time" 		property="willtime" />
		<result column="examine_result" 	property="auditopinion" />
		<result column="examine_amount" 	property="examineamount" />
		<result column="jkrq" 	property="audittime" />
		<result column="zjts" 	property="zjdays" />
		<result column="examine_lv"	    property="examine" 	 />
		<result column="status" 		property="status" />
		<result column="id" 		property="id" />
		<result column="CARD_ID" 		property="cardId" />
		<result column="carId" 		property="zjmh" />
		
		
 	 </resultMap>
	
	  <!-- <resultMap id="BaseResultMap" type="com.cardpay.pccredit.customer.model.TyRepayTkmxForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	  </resultMap>
 	 
 	 <resultMap id="BaseResultMap1" type="com.cardpay.pccredit.customer.model.TyRepayLshForm" >
   		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
 	 </resultMap>
 	
 	
	 	<select id="findListByFilter" resultMap="BaseResultMap" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.product_name as productName,c.zjhm from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
		</select>
		
	<select id="findListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*) from ty_repay_tkmx a left join ty_product_type b on a.cpmc=b.product_code
					  left join ty_customer_base c on c.khnm=a.khh 
					  WHERE 1=1 
					  <if test="zjhm != null and zjhm != '' ">
						AND c.zjhm=#{zjhm}
					 </if>
					  order by c.zjhm,a.khjl
	</select> 
	
	
	<select id="findLshListByFilter" resultMap="BaseResultMap1" 
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,b.khjl as khjl1  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
					  order by a.jjh,b.khjl 
					
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findLshListCountByFilter" resultType="int"
			parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from ty_repay_lsz a left join ty_repay_tkmx b on a.jjh=b.jjh  
					  WHERE 1=1 
					  <if test="jjh != null and jjh != '' ">
						AND a.jjh=#{jjh}
					 </if>
	</select>  -->
	
	
	<select id="findJJJnListByFilter" resultMap="BaseResultMap1" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select *  from t_fcloaninfo a WHERE 1=1 
					   <if test="busiCode != null and busiCode != '' ">
						AND trim(a.BUSICODE)=#{busiCode}
					   </if>
					  <if test="cardNum != null and cardNum != '' ">
							AND trim(a.CARDNUM)=#{cardNum}
					  </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="findJJJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from t_fcloaninfo a  WHERE 1=1 
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(a.BUSICODE)=#{busiCode}
		</if>
		<if test="cardNum != null and cardNum != '' ">
			AND trim(a.CARDNUM)=#{cardNum}
	   </if>
	</select>
	
	
	
	<select id="findLshJnListByFilter" resultMap="lszform" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					 select
       distinct 
       tkmx.ywbh,
       b.khmc,
       tkmx.jkrq,
       shbj.df as bj,
       shlx.df as lx,
       tkmx.jxfs,
       shbj.jzrq,
       yehz.create_time
       from
        (select  sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
              and lsz.zy='批量自动扣利息'
           
              group by   tkmx.ywbh , c.zjhm) shlx,
      (select  c.khmc,
              sum(lsz.df) as df ,
                      tkmx.ywbh ,
                      c.zjhm,
                       max(lsz.jzrq) as jzrq
              from
               ty_customer_rygl rygl,
              TY_REPAY_TKMX tkmx ,
              TY_REPAY_YEHZ yehz,
              ty_repay_lsz lsz,
              ty_customer_base c,
             ty_product_type protype,
              sys_user sysuser
              where  c.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              c.KHNM = tkmx.khh and
              yehz.JJH = tkmx.JJH and
              protype.product_code=tkmx.cpmc and
              lsz.jjh=tkmx.jjh 
            and (lsz.zy='批量自动扣本金'
            or lsz.zy='贷款柜台提前还款')
            
              group by   tkmx.ywbh , c.zjhm ,c.khmc) shbj,
              ty_repay_tkmx tkmx,
              ty_customer_base b,
              ty_customer_rygl rygl,
              sys_user sysuser,
             ty_kdk_jh jh,
              ty_repay_yehz yehz,
              ty_repay_lsz lsz
              where b.khjl=rygl.dm and
              rygl.ddrq=sysuser.external_id and
              b.khnm=tkmx.khh and
              jh.ywbh=tkmx.ywbh||'HT' and
              yehz.jjh=tkmx.jjh and
              tkmx.jjh =lsz.jjh and
              
               shlx.ywbh=tkmx.ywbh and
              shlx.zjhm=b.zjhm and
             shbj.ywbh=tkmx.ywbh and
              shbj.zjhm=b.Zjhm
               <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
			 <if test="busiCode != null and busiCode != '' ">
					AND trim(tkmx.ywbh)=#{busiCode}
			</if>
                 order by tkmx.jkrq
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	<select id="selectRarepaylistfoInfoByBusicode" resultMap="BaseResultMap2" parameterType="com.cardpay.pccredit.postLoan.filter.FcloaninfoFilter">

	    		select a.* from T_RAREPAYLIST a WHERE 1=1 
						AND a.BUSICODE=#{busiCode}
		<if test="rapayinterest != null and rapayinterest != '' ">
		   				AND a.rapayinterest=#{rapayinterest}
		   				</if>
		<if test="repayamt != null and repayamt != '' ">
		   				AND a.repayamt=#{repayamt}
		   				</if>
	</select>
	
	<select id="findLshJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from T_RAREPAYLIST a  WHERE 1=1 
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(a.BUSICODE)=#{busiCode}
		</if>
	</select>
	
	<select id="findObjectsByBusicode" resultMap="BaseResultMap1">
	    select *  from t_fcloaninfo a where 1=1 and 
	    a.BUSICODE=#{busicode}
	    
	</select>
	
	
	
	<select id="findTzJnListByFilter" resultMap="BaseResultMap3" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select a.*,trim(a.ACCOUNTSTATE) as STATE from t_mibusidata_view a where 1=1
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(a.BUSICODE)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND cname =#{customerName}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
	
	<select id="findTzJnListCountByFilter" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from t_mibusidata_view where 1=1
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(BUSICODE)=#{busiCode}
		</if>
		
	  	<if test="customerName != null and customerName != '' ">
			AND cname =#{customerName}
		 </if>
	</select>
	
		<select id="findrefusedMibusidata" resultMap="BaseResultMap3" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
					SELECT * FROM
			(SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					    select a.*,trim(a.ACCOUNTSTATE) as STATE,info.SPMC,lsz.JF,pro.AUDIT_TIME,pro.REFUSAL_REASON,sysuser.DISPLAY_NAME
				   from t_mibusidata_view a ,
			            customer_application_info app,
			            basic_customer_information info,
			            ty_customer_base b,
			            ty_repay_tkmx tkmx,
			            TY_REPAY_LSZ lsz,
			            product_attribute prod,
			            customer_application_process pro,
			            sys_user sysuser
			            where 1=1
			            and b.id=info.TY_CUSTOMER_ID
			            and b.KHH = tkmx.KHH
			            and tkmx.YWBH=a.BUSICODE
			            and tkmx.JJH=lsz.JJH
			            and app.customer_id = info.id
			            and app.product_id = prod.id
			            and app.id = pro.application_id
						and sysuser.id = info.user_id 
			            and app.status ='refuse'
						
					 <if test="busiCode != null and busiCode != '' ">
						AND trim(a.BUSICODE)=#{busiCode}
					 </if>
					 
					 <if test="customerName != null and customerName != '' ">
						AND cname =#{customerName}
					 </if>
		 <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	
		<select id="findrefusedMibusidatasize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.filter.PostLoanFilter">
	  	select count(*)  from t_mibusidata_view a ,
			            customer_application_info app,
			            basic_customer_information info,
			            ty_customer_base b,
			            ty_repay_tkmx tkmx,
			            product_attribute prod,
			            customer_application_process pro,
			            sys_user sysuser
			            where 1=1
			            and b.id=info.TY_CUSTOMER_ID
			            and b.KHH = tkmx.KHH
			            and tkmx.YWBH=a.BUSICODE
			            and app.customer_id = info.id
			            and app.product_id = prod.id
			            and app.id = pro.application_id
						 and sysuser.id = info.user_id 
			            and app.status ='refuse'
	  	<if test="busiCode != null and busiCode != '' ">
			AND trim(BUSICODE)=#{busiCode}
		</if>
		
	  	<if test="customerName != null and customerName != '' ">
			AND cname =#{customerName}
		 </if>
	</select>
	
	<!-- 信贷流程跟踪表 -->
	<select id="queryCreditProcess" resultMap="CreditProcess">
		  SELECT *from 
		  (SELECT ROW_.*,ROWNUM ROWNUM_
				FROM (
					  select 
            bai.spmc,
            bai.chinese_name,
            (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
             (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             su.display_name,
            cai.created_time,
            cai.apply_quota,
             cai.status,
             bai.id
             from wf_status_queue_record t 
             left join wf_status_info s on t.current_status = s.id 
             left join wf_process_record pr on t.current_process = pr.id 
             left join customer_application_process aa on pr.id = aa.serial_number
              left join sys_user su on t.examine_user = su.id 
              left join customer_application_info cai on cai.id=aa.application_id
              left join basic_customer_information bai on cai.customer_id=bai.id
              left join ty_customer_base base on bai.ty_customer_id=base.id
              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
              where 1=1
					<!-- select 
	                bai.spmc,bai.chinese_name,trt.bljg,trt.dklx,
					m.mainassure,m.industry,s.status_name,bai.id
					from
					wf_status_queue_record t ,
				    wf_status_info s,
				    wf_process_record pr,
				    customer_application_process cap,
				    customer_application_info cai,
				    TY_CUSTOMER_RECORD tcr,
				    BASIC_CUSTOMER_INFORMATION bai,
				    ty_customer_base tcb,
				    TY_REPAY_TKMX trt,
				    t_mibusidata  m
				    where t.current_status = s.id
				    and t.current_process = pr.id
				    and pr.id = cap.serial_number
				    and tcr.application_id=cap.application_id
				    and cai.id = tcr.application_id
			    	and bai.id=cai.customer_id 
		        	and tcb.id=bai.ty_customer_id
		            and trt.khh=tcb.khnm
			        and trt.jjh=m.cnlno -->
					<if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
					
                   <![CDATA[		
							) ROW_
						WHERE ROWNUM <= #{limit}*#{page} + #{limit}) 
					WHERE ROWNUM_ > #{limit}*#{page}
					]]>
	</select>
	<!-- 统计行数 -->
	<select id="querySize" resultType="int" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
		  select count(*)
		          from 
			wf_status_queue_record t 
						 left join wf_status_info s on t.current_status = s.id 
						 left join wf_process_record pr on t.current_process = pr.id 
						 left join customer_application_process aa on pr.id = aa.serial_number
						  left join sys_user su on t.examine_user = su.id 
						  left join customer_application_info cai on cai.id=aa.application_id
						  left join basic_customer_information bai on cai.customer_id=bai.id
						  left join ty_customer_base base on bai.ty_customer_id=base.id
			  			left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
			        <if test="customername!=null and customername!='' ">
						    and bai.chinese_name like  '%'||#{customername}||'%'
					</if>
					
	</select>
	
	<!-- 显示详情 -->
	<select id="queryAll" resultMap="CreditProcess" parameterType="String">
			<!-- select 
		      bai.spmc, bai.chinese_name,trt.bljg,trt.dklx, m.mainassure,m.industry, m.busimanager, tcb.ghjl,
		      cai.created_time,cai.apply_quota,tcr.intime,cai.modified_time,t.start_examine_time, t.examine_result,
		      t.examine_amount, trunc(to_timestamp(trt.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff')) jkrq,
		      trt.HTLL,s.status_name
      		from
		      wf_status_queue_record t ,
		      wf_status_info s,
		      wf_process_record pr,
		      customer_application_process cap,
		      customer_application_info cai,
		      TY_CUSTOMER_RECORD tcr,
		      BASIC_CUSTOMER_INFORMATION bai,
		      ty_customer_base tcb,
		      TY_REPAY_TKMX trt,
		      T_MIBUSIDATA m
		      where t.current_status = s.id
		      and t.current_process = pr.id
		      and pr.id = cap.serial_number
		      and tcr.application_id=cap.application_id
		      and cai.id = tcr.application_id
		      and bai.id=cai.customer_id 
		      and tcb.id=bai.ty_customer_id
		      and trt.khh=tcb.khnm
		      and trt.jjh=m.cnlno
		      and bai.id=#{id} -->
		      select
            bai.spmc,
            bai.chinese_name,
            (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
            (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
            (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
            cai.created_time,
            cai.apply_quota,
             t.start_examine_time,
              t.examine_result,
             t.examine_amount,
             cai.jkrq,
             aa.examine_lv,
             cai.status
             from wf_status_queue_record t 
             left join wf_status_info s on t.current_status = s.id 
             left join wf_process_record pr on t.current_process = pr.id 
             left join customer_application_process aa on pr.id = aa.serial_number
              left join sys_user su on t.examine_user = su.id 
              left join customer_application_info cai on cai.id=aa.application_id
              left join basic_customer_information bai on cai.customer_id=bai.id
              left join ty_customer_base base on bai.ty_customer_id=base.id
              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
              where 1=1 and bai.id=#{id}
	</select>
	
	<!-- 导出-->
	<select id="creditProcessExportQueryAll" resultMap="CreditProcess" parameterType="com.cardpay.pccredit.postLoan.model.CreditProcess">
			
			<!-- select 
		      bai.spmc, bai.chinese_name,trt.bljg,trt.dklx, m.mainassure,m.industry, m.busimanager, tcb.ghjl,
		      cai.created_time,cai.apply_quota,tcr.intime,cai.modified_time,t.start_examine_time, t.examine_result,
		      t.examine_amount,trunc(to_timestamp(trt.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff')) jkrq,
		      trunc(trunc(to_timestamp(trt.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff'))- cai.created_time) zjts,
		      trt.HTLL,s.status_name
      		from
		      wf_status_queue_record t ,
		      wf_status_info s,
		      wf_process_record pr,
		      customer_application_process cap,
		      customer_application_info cai,
		      TY_CUSTOMER_RECORD tcr,
		      BASIC_CUSTOMER_INFORMATION bai,
		      ty_customer_base tcb,
		      TY_REPAY_TKMX trt,
		      T_MIBUSIDATA m
		      where t.current_status = s.id
		      and t.current_process = pr.id
		      and pr.id = cap.serial_number
		      and tcr.application_id=cap.application_id
		      and cai.id = tcr.application_id
		      and bai.id=cai.customer_id 
		      and tcb.id=bai.ty_customer_id
		      and trt.khh=tcb.khnm
		      and trt.jjh=m.cnlno -->
		       select
            bai.spmc,
            bai.chinese_name,
            (select t.name from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)) as teamname,
            (select org.name from sys_organization org where id in(select t.org_id from sys_department t where t.id in 
             (select tt.dept_id from sys_dept_user tt where tt.user_id = su.id)))as bljg ,
             ''as dklx,
            (SELECT  A.TYPE_NAME  FROM DICT A ,PRODUCT_ATTRIBUTE p 
             WHERE A .DICT_TYPE = 'CMMSCLNM-贷款担保方式' and A.TYPE_CODE=p.assure_means and p.id=cai.product_id) as assure_means,
             '' as hyfl,
             su.display_name,
            cai.created_time,
            cai.apply_quota,
             t.start_examine_time,
              t.examine_result,
             t.examine_amount,
             trunc(to_timestamp(cai.jkrq, 'yyyy-mm-dd hh24:mi:ss.ff')) as jkrq,
             aa.examine_lv,
             cai.status,
             bai.CARD_ID
             from wf_status_queue_record t 
             left join wf_status_info s on t.current_status = s.id 
             left join wf_process_record pr on t.current_process = pr.id 
             left join customer_application_process aa on pr.id = aa.serial_number
              left join sys_user su on t.examine_user = su.id 
              left join customer_application_info cai on cai.id=aa.application_id
              left join basic_customer_information bai on cai.customer_id=bai.id
              left join ty_customer_base base on bai.ty_customer_id=base.id
              left join PRODUCT_ATTRIBUTE p on p.id=cai.product_id
	</select>
	
	<!-- 根据身份证号查询是否转贷 -->
	<select id="queryByCardId" resultMap="CreditProcess" parameterType="String">
		     select zjhm from  ty_customer_base base where base.zjhm=#{cardId} or base.posfzh=#{cardId}
	</select>
</mapper>
